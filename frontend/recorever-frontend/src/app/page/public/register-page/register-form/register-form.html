<form [formGroup]="registerForm"
      (ngSubmit)="onSubmit()"
      class="register-form">

  <h2 class="form-title">Register</h2>

  <!-- Username Field -->
  <div class="form-field">
    <label for="name">Username</label>
    <input id="name"
           type="text"
           formControlName="name"
           placeholder="Enter your username"/>

    @if (name?.invalid && (name?.dirty || name?.touched)) {
      <div class="error-message">
        @if (name?.errors?.['required']) {
          <span>Name is required.</span>
        }

        @if (name?.errors?.['notUnique']) {
          <span>This username is already taken.</span>
        }
      </div>
    }
  </div>

  <!-- Phone Number Field -->
  <div class="form-field">
    <label for="phone_number">Phone Number</label>
    <input id="phone_number"
           type="tel"
           formControlName="phone_number"
           placeholder="09xxxxxxxx"/>

    @if (
      phone_number?.invalid &&
      (phone_number?.dirty || phone_number?.touched)
    ) {
      <div class="error-message">
        @if (phone_number?.errors?.['required']) {
          <span>Phone number is required.</span>
        }
        @if (phone_number?.errors?.['pattern']) {
          <span>Please enter a valid PH phone number.</span>
        }
        @if (phone_number?.errors?.['notUnique']) {
          <span>This phone number is already registered.</span>
        }
      </div>
    }
  </div>

  <!-- Email Field -->
  <div class="form-field">
    <label for="email">Email</label>
    <input id="email"
           type="email"
           formControlName="email"
           placeholder="example@mail.com"/>

    @if (email?.invalid && (email?.dirty || email?.touched)) {
      <div class="error-message">
        @if (email?.errors?.['required']) {
          <span>Email is required.</span>
        }
        @if (email?.errors?.['email']) {
          <span>Please enter a valid email address.</span>
        }
        @if (email?.errors?.['notUnique']) {
          <span>This email is already in use.</span>
        }
      </div>
    }
  </div>

  <!-- Password Field -->
  <div class="form-field">
    <label for="password">Password</label>
    <div class="password-wrapper">
      <input id="password"
             [type]="passwordFieldType"
             formControlName="password"
             placeholder="Password"/>

      <button type="button"
              class="toggle-visibility"
              (click)="togglePasswordVisibility()">

        @if (passwordFieldType === 'password') {
          <img src="assets/eye-close.png"
               alt="Show password"
               class="eye-icon"/>
        } @else {
          <img src="assets/eye-open.png"
               alt="Hide password"
               class="eye-icon"/>
        }
      </button>
    </div>

    <!-- Password Strength Meter -->
    @if (passwordStrength !== 'none' && password?.value) {
      <div class="strength-meter">
        <span class="strength-text">Strength:</span>
        <div class="strength-bar-container">
          <div class="strength-bar" [ngClass]="passwordStrength"></div>
        </div>
        <span class="strength-label" [ngClass]="passwordStrength">
          {{ passwordStrength }}
        </span>
      </div>
    }

    @if (password?.invalid && (password?.dirty || password?.touched)) {
      <div class="error-message">
        @if (password?.errors?.['required']) {
          <span>Password is required.</span>
        }
        @if (password?.errors?.['minlength']) {
          <span>Password must be at least 8 characters long. </span>
        }
        @if (password?.errors?.['passwordStrength']?.hasNumber) {
          <span>Must contain at least one number. </span>
        }
        @if (password?.errors?.['passwordStrength']?.hasSpecialChar) {
          <span>Must contain at least one special character.</span>
        }
      </div>
    }
  </div>

  <!-- Confirm Password Field -->
  <div class="form-field">
    <label for="confirmPassword">Confirm Password</label>
    <div class="password-wrapper">
      <input id="confirmPassword"
             [type]="confirmPasswordFieldType"
             formControlName="confirmPassword"
             placeholder="Re-type your password"/>

      <button type="button"
              class="toggle-visibility"
              (click)="toggleConfirmPasswordVisibility()">
        @if (confirmPasswordFieldType === 'password') {
          <img src="assets/eye-close.png"
               alt="Show password"
               class="eye-icon"/>
        } @else {
          <img src="assets/eye-open.png"
               alt="Hide password"
               class="eye-icon"/>
        }
      </button>
    </div>

    @if (
      confirmPassword?.invalid &&
      (confirmPassword?.dirty || confirmPassword?.touched)
    ) {
      <div class="error-message">
        @if (confirmPassword?.errors?.['required']) {
          <span>Please confirm your password.</span>
        }
        @if (
          confirmPassword?.errors?.['passwordMismatch'] &&
          !confirmPassword?.errors?.['required']
        ) {
          <span>Passwords do not match.</span>
        }
      </div>
    }
  </div>

  @if (errorMessage) {
    <div class="global-error-alert">
      {{ errorMessage }}
    </div>
  }

  <!-- Submit Button -->
  <button type="submit"
          class="submit-button"
          [disabled]="registerForm.invalid || isLoading || registerForm.pending">
    @if (isLoading || registerForm.pending) {
      Processing...
    } @else {
      Register
    }
  </button>

  <p class="signin-link">
    Already have an account? <a routerLink="/login">Log in</a>
  </p>
</form>