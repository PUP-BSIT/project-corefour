<div class="item-list-page">
  <header class="item-list-page__header">
    <h1 class="item-list-page__title">{{ pageTitle() }}</h1>
    <div class="item-list-page__search-wrapper">
      <div class="search-section">
      <app-search-bar
        [suggestions]="searchSuggestions()"
        (queryChange)="onQueryChange($event)"
        (search)="onSearchSubmit($event)">
      </app-search-bar>
    </div>
    </div>

    <div class="item-list-page__toggle-wrapper">
      <button
        type="button"
        class="toggle-button"
        [class.toggle-button--active]="!showResolved()"
        (click)="toggleStatus(false)">
        {{ itemType() === 'found' ? 'Unclaimed Items' : 'Unresolved Items' }}
      </button>
      <button
          type="button"
          class="toggle-button"
          [class.toggle-button--active]="showResolved()"
          (click)="toggleStatus(true)">
          {{ itemType() === 'found' ? 'Claimed Items' : 'Resolved Items' }}
      </button>
    </div>
  </header>

  <app-filter
    [locations]="locations()"
    [itemType]="itemType()"
    (filterChange)="onFilterChange($event)">
  </app-filter>

  <div class="item-list-page__content">
    @if (allReports().length > 0) {
      <app-report-item-grid
        [items]="visibleReports()"
        [currentUserId]="currentUserId()"
        (cardClicked)="onCardClick($event)"
        (cardTicketClicked)="onTicketClick($event)"
        (cardEditClicked)="onEditClick($event)"
        (cardDeleteClicked)="onDeleteClick($event)"
        (cardViewCodeClicked)="onViewCodeClick($event)">
      </app-report-item-grid>
    }

    <div #scrollAnchor class="scroll-anchor">
      @if (isLoading()) {
        <div class="content-message">
           <div class="spinner"></div>
           <span>Loading items...</span>
        </div>
      } @else if (error()) {
        <div class="content-message content-message--error">{{ error() }}</div>
      } @else if (allReports().length === 0) {
        <div class="content-message">
          No items found.
        </div>
      } @else if (currentPage() >= totalPages()) {
        <div class="end-of-list">No more items to display.</div>
      }
    </div>
  </div>
</div>

@if (showDeleteModal()) {
  <app-delete-report-modal
      (confirm)="confirmDelete()"
      (cancel)="cancelDelete()">
  </app-delete-report-modal>
}

@if (viewCodeItem()) {
  <app-codes-modal
      [title]="codeModalTitle()"
      [code]="codeModalValue()"
      (close)="viewCodeItem.set(null)">
  </app-codes-modal>
}

@if (selectedItem(); as item) {
  <app-item-detail-modal
      [item]="item"
      [currentUserId]="currentUserId()"
      [userProfilePicture]="getUserProfilePicture()"
      (close)="selectedItem.set(null)"
      (viewTicket)="onModalViewTicket()"
      (editClicked)="onModalEdit()"
      (deleteClicked)="onModalDelete()"
      (viewCodeClicked)="onModalViewCode()">
  </app-item-detail-modal>
}