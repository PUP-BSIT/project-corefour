<div class="report-status-page">
  <header class="report-status-page__header">
    <h1 class="report-status-page__title">Manage Lost Item</h1>

    <div class="report-status-page__search-wrapper">
      <app-search-bar (search)="onSearchSubmit($event)"></app-search-bar>
    </div>

    <div class="status-filter-wrapper">
      <label for="status-filter">Status:</label>
      <select id="status-filter"
              #statusSelect
              [value]="currentStatusFilter()"
              (change)="setStatusFilter(statusSelect.value)">
        @for (status of statusFilters; track status) {
          <option [value]="status">
            {{ status | titlecase }}
          </option>
        }
      </select>
    </div>
  </header>

  <div class="controls-bar">
    <div class="sort-tabs">
      <button class="tab-btn"
          [class.active]="currentSort() === 'all'"
          (click)="setSort('all')">
        All
      </button>
      <button class="tab-btn"
          [class.active]="currentSort() === 'az'"
          (click)="setSort('az')">
        A-Z ↑
      </button>
      <button class="tab-btn"
          [class.active]="currentSort() === 'date'"
          (click)="setSort('date')">
        Date ↑
      </button>
    </div>
  </div>

  <div class="report-status-page__content">
    @if (reports().length > 0) {
      <app-report-item-grid
          [items]="sortedReports()"
          [highlightId]="highlightId()"
          (cardClicked)="onViewDetails($event)">
      </app-report-item-grid>
    }

    <div #scrollAnchor class="scroll-anchor">
      @if (isLoading()) {
        <div class="status-message">
           <div class="spinner"></div>
           <span>Loading more reports...</span>
        </div>
      } @else if (isError()) {
        <div class="status-message error">
            Error fetching reports. Please try again.</div>
      } @else if (reports().length === 0) {
        <div class="status-message">No reports found.</div>
      } @else if (currentPage() >= totalPages()) {
        <div class="status-message end-message">
            No more reports to display.</div>
      }
    </div>
  </div>

  @if (selectedReport(); as report) {
    <app-item-detail-modal
        [item]="report"
        [currentUserId]="currentUserId()"
        [userProfilePicture]="getUserProfilePicture()"
        [isAdmin]="true"
        (statusChanged)="onStatusUpdate($event)"
        (close)="onCloseDetailView()">
    </app-item-detail-modal>
  }
</div>