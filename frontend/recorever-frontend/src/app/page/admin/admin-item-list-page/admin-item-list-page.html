<div class="admin-item-list-page">
  <header class="page-header">
    <h1 class="page-title">{{ pageTitle() }}</h1>
    <div class="search-wrapper">
      <app-search-bar (search)="onSearch($event)"></app-search-bar>
    </div>
  </header>

  <div class="filter-section">
    <app-filter
      [locations]="locationFilters()"
      [itemType]="itemType()"
      (filterChange)="onFilterChange($event)">
    </app-filter>
  </div>

  <div class="content-section">
    @if (filteredReports().length > 0) {
      <app-report-item-grid
        [items]="filteredReports()"
        [currentUserId]="currentUserId()"
        [isArchiveView]="isArchiveView()"
        [highlightId]="highlightId()"
        [isAdmin]="true"
        (cardClicked)="onCardClick($event)"
        (unarchiveClicked)="onUnarchive($event)"
        (cardTicketClicked)="onTicketClick($event)"
        (cardEditClicked)="onEditClick($event)"
        (cardDeleteClicked)="onDeleteClick($event)"
        (cardViewCodeClicked)="onViewCodeClick($event)">
      </app-report-item-grid>
    }

    <div #scrollAnchor class="scroll-anchor">
      @if (isLoading()) {
        <div class="content-message">
          <div class="spinner"></div>
          <span>{{ allReports().length === 0 ?
              'Loading reports...' : 'Loading more items...' }}</span>
        </div>
      } @else if (error()) {
        <div class="content-message content-message--error">{{ error() }}</div>
      } @else if (filteredReports().length === 0 && !isLoading()) {
        <div class="content-message">
          No {{ isArchiveView() ? 'archived' : '' }} items found.
        </div>
      } @else if (currentPage() >= totalPages() && !isLoading()) {
        <div class="content-message end-of-list">
          No more items to display.
        </div>
      }
    </div>
  </div>
</div>

@if (viewCodeItem()) {
  <app-codes-modal
      [title]="codeModalTitle()"
      [code]="codeModalValue()"
      (close)="viewCodeItem.set(null)">
  </app-codes-modal>
}

@if (selectedItem(); as item) {
  @if (isArchiveView() && (item.status === 'claimed')) {
    <app-claim-form-modal
      [claimData]="item"
      [isReadOnly]="true"
      [isArchive]="true"
      (close)="selectedItem.set(null)"
      (unarchive)="onModalUnarchive()">
    </app-claim-form-modal>
  } @else {
    <app-item-detail-modal
      [item]="item"
      [currentUserId]="currentUserId()"
      [userProfilePicture]="getUserProfilePicture()"
      [isArchiveView]="isArchiveView()"
      [isAdmin]="true"
      (close)="selectedItem.set(null)"
      (unarchiveClicked)="onModalUnarchive()"
      (editClicked)="onModalEdit()"
      (deleteClicked)="onModalDelete()"
      (viewCodeClicked)="onModalViewCode()">
    </app-item-detail-modal>
  }
}

@if (itemToUnarchive()) {
  <app-unarchive-confirmation-modal
    (confirm)="processUnarchive()"
    (cancel)="cancelUnarchive()">
  </app-unarchive-confirmation-modal>
}