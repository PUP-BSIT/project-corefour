<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">

    <div class="modal-header">
      @if (step === 'confirm') {
        <h2>Confirm Match</h2>
      } @else {
        <h2>It's a Match!</h2>
      }
      <button class="close-btn" (click)="onClose()">
        <img src="assets/remove.png" alt="Close">
      </button>
    </div>

    <div class="modal-body">
      @if (step === 'confirm') {
        <div class="step-content">
          <p class="instruction-text">
            An item has been found that matches your report.
                Please review the details below.
            <br><strong>Is this the item you lost?</strong>
          </p>

          <div class="item-card">
            @if (imageUrl) {
              <img [src]="imageUrl" alt="Item Image" class="item-image">
            } @else {
              <div class="no-image-placeholder">No Image Available</div>
            }

            <div class="item-info">
              <h3>{{ report.item_name }}</h3>
              <p class="description">{{ report.description }}</p>

              <div class="meta-row">
                <span class="label">Location found:</span>
                <span class="value">{{ report.location }}</span>
              </div>

              <div class="meta-row">
                <span class="label">Date:</span>
                <span class="value">{{ (report.date_lost_found ||
                    report.date_reported) | date:'mediumDate' }}</span>
              </div>
            </div>
          </div>

          <div class="actions-row">
            <button mat-stroked-button color="warn" (click)="onClose()">
              No, not mine
            </button>
            <button mat-flat-button color="primary"
                (click)="onConfirmOwnership()"> Yes, it's mine
            </button>
          </div>
        </div>
      }

      @if (step === 'success') {
        <div class="step-content success-view">
          <div class="success-icon">
            <img src="assets/check-icon.png" alt="Success">
          </div>

          <h3>Verification Successful</h3>
          <p class="sub-text">
            Please present this <strong>Reference Code</strong> to the
            <strong>OSAS Office</strong> to claim your item.
          </p>

          <div class="reference-code-box">
            <span class="label">REFERENCE CODE</span>
            <span class="code">REF-{{ report.report_id }}</span>
          </div>

          <div class="reminder-box">
            <p><strong>Note:</strong> You may be asked to provide additional
                proof of ownership (e.g., ID, specific description) upon
                claiming.</p>
          </div>

          <div class="actions-row single-action">
            <button mat-flat-button color="primary" (click)="onClose()">
              Done
            </button>
          </div>
        </div>
      }
    </div>

  </div>
</div>