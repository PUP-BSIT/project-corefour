<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" 
      (click)="$event.stopPropagation(); closeDropdown()">
    
    @if (isLoading()) {
      <div class="loading-state">Loading details...</div>
    } @else {
      <div class="left-panel">
        <div class="header-mini">
          <div class="avatar">
            {{ reportOwnerName().charAt(0).toUpperCase() }}
          </div>
          <div class="meta">
            <div class="reporter-name">{{ reportOwnerName() }}</div>
            <div class="item-date">
              {{ displayDate | date:'mediumDate' }}
            </div>
          </div>
        </div>

        <div class="image-carousel">
          <button class="nav-btn prev" (click)="prevImage()">
             <img src="assets/Arrow-left.png" alt="Prev">
          </button>
          <div class="image-wrapper">
             <img 
                 [src]="images()[activeImageIndex()]" 
                 alt="Item Image" 
                 class="main-image">
          </div>
          <button class="nav-btn next" (click)="nextImage()">
            <img src="assets/arrow-right.png" alt="Next">
          </button>
        </div>

        <div class="item-details">
          <h2 class="title">{{ report()?.item_name }}</h2>
          <div class="location">
            <strong>Location:</strong> {{ report()?.location }}
          </div>
          <p class="description">
            {{ report()?.description }}
          </p>
        </div>

        <div class="status-section">
          <div class="status-dropdown-wrapper">
            <button 
                  class="status-btn" 
                  [ngClass]="(report()?.status || 'pending').toLowerCase()"
                  (click)="toggleDropdown($event)">
              {{ report()?.status || 'Pending' }}
              <span class="arrow">â–¼</span>
            </button>
            
            @if (isDropdownOpen()) {
              <div 
                    class="dropdown-content"
                    (click)="$event.stopPropagation()">
                @for (option of STATUS_OPTIONS; track option.value) {
                  <div
                        [class.disabled-option]="isStatusDisabled(option.value)"
                        (click)="onStatusOptionClick(option.value)">
                    {{ option.label }}
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>

      <div class="right-panel" [formGroup]="claimForm">
        
        <div class="section claimant-details-section">
          <h3>Claimant Details:</h3>
          
          <div class="input-group">
            <label>Claimant Name <span style="color:red">*</span></label>
            <input 
              type="text" 
              class="input-field" 
              [class.error]="claimForm.get('claimantName')?.invalid && claimForm.get('claimantName')?.touched"
              formControlName="claimantName"
              placeholder="Enter full name">
              
            @if (claimForm.get('claimantName')?.invalid && claimForm.get('claimantName')?.touched) {
              <div class="error-msg">Name is required</div>
            }
          </div>
          
          <div class="input-group">
            <label>Claim Date</label>
            <input 
              type="text" 
              class="input-field readonly" 
              formControlName="claimDate"
              readonly>
          </div>
        </div>

        <div class="section contact-details-section">
          <h3>Contact Details (Optional):</h3>
          
          <div class="input-group">
            <label>Contact Email</label>
            <input 
              type="email" 
              class="input-field" 
              formControlName="contactEmail"
              placeholder="Email address">
          </div>
          
          <div class="input-group">
            <label>Contact Phone</label>
            <input 
              type="tel" 
              class="input-field" 
              formControlName="contactPhone"
              placeholder="Phone number">
          </div>
        </div>

        <div class="section remarks-section">
          <h3>Remarks:</h3>
          <textarea 
              class="input-field textarea" 
              formControlName="remarks"
              placeholder="Admin remarks...">
          </textarea>
        </div>

        <div class="action-buttons">
          <button 
              class="save-btn" 
              [disabled]="isSaving()" 
              (click)="saveItemDetails()">
            {{ isSaving() ? 'Saving...' : 'Submit' }}
          </button>
        </div>
      </div>
    }
  </div>
</div>